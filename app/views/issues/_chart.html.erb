<% if @tocat_chart_data %>
  <div>
    <h3>TOCAT: Current delta</h3>
  </div>

  <div class='chart_container'>
    <div id="chart"></div>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" type="text/css">
    <link href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

    <style>
      .c3-axis-x .tick {
        display: none;
      }
      .c3-axis-y .tick {
        display: none;
      }
    </style>
    <script>
      var chart = c3.generate({
        bindto: '#chart',
        size: {
          height: 300,
          width: 300
        },
        padding: {
          left: 10
        },
        data: {
          x: 'Time',
          json: {
            Balance: <%= @tocat_chart_data[:balance] %>,
            Time: <%== @tocat_chart_data[:timeline].map { |d| d.strftime('%Y-%m-%d') } %>
          },
          type: 'spline',
          colors: {
            Zero: 'red'
          }
        },
        point: {
          show: false
        },
        axis: {
          x: {
            type: 'timeseries',
            localtime: false,
            tick: {
              culling: false
            }
          }
        },
        tooltip: {
          format: {
            title: function (d) {
              return d;
            },
            value: function (value, ratio, id) {
              if (id != 'Zero') {
                return '$' + value;
              }
            }
          }
        },
        legend: {
          show: false
        }
      });
      chart.flush();
      chart.load({
        unload: ['Balance', 'Time'],
        json: {
          Balance: <%== @tocat_chart_data[:balance] %>,
          Time: <%== @tocat_chart_data[:timeline].map { |d| d.strftime('%Y-%m-%d') } %>
        }
      });
    </script>
  </div>
<% end %>
