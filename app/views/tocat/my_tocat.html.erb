
<h2><%= avatar @user, :size => "50" %> <%= h @user.name %></h2>
<hr/>
<%=t 'label_team_balance', name: @team_tocat.name %>
<strong> $<%= @team_tocat.balance_account_state.round(2)%></strong><br/>
<hr/>
<div class="splitcontentleft">
  <% unless @user_tocat.role == 'Manager' %>
    <label><%=	l(:label_balance)  %></label><strong> $<%= @user_tocat.balance_account_state.round(2)%></strong><br/>
    <%= render 'transactions', :transactions => @balance_transactions %>
  <% end %>
    <label><%=	l(:label_payment_balance)  %></label><strong> $<%= @user_tocat.income_account_state.round(1) %></strong><br/>
    <%= render 'transactions', :transactions => @income_transactions %>
</div>
<div class="splitcontentright">
  <% if @user_tocat.role == 'Manager' %>
      <label>  <%=t 'label_team_payment', name: @team_tocat.name %></label>
      <strong> $<%= @team_tocat.income_account_state.round(2) %></strong><br/>
      <%= render 'transactions', :transactions => @team_income_transactions %>
  <% else %>
      <br/>
      <label><%=	l(:label_not_accepted_issues)  %> <strong>$<%= @not_accepted_balance.round(1) %> </strong> </label>
      <%= render 'issues', :issues => @not_accepted_tasks, :accepted => 0 %>
      <label><%=	l(:label_accepted_issues)  %> <strong>$<%= @accepted_balance.round(1) %> </strong> </label>
      <%= render 'issues', :issues => @accepted_tasks, :accepted => 1, :balance => @accepted_balance.round(1) %>
  <% end %>
</div>
<div style="clear:both;"></div>


<% html_title "TOCAT : My dashboard" %>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script charset="utf-8">jQuery.noConflict()</script>


<hr/>
<div class='chart_container'>
  <style>
  #chart_container {
          position: relative;
          display: inline-block;
          font-family: Arial, Helvetica, sans-serif;
  }
  #chart {
          display: inline-block;
  }
  #zeroline {
          color: red;
  }
  </style>
  <fieldset>
    <legend>Personal dynamics</legend>
    <div>
      <%= content_tag :div, "", id: "chart", data: { balance: @balance_chart[:balance], forecast: @balance_chart[:forecast], zero_line: @balance_chart[:zero_line], time: @balance_chart[:timeline], test:  @balance_chart[:temp]  } %>
    </div>
  </fieldset>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" type="text/css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.9/c3.js"></script>


  <script>

  var chart = c3.generate({
    bindto: '#chart',
    data: {
      x: 'Time',
      json: {
            Zero: jQuery('#chart').data('zero-line'),
            Balance: jQuery('#chart').data('balance'),
            'Balance Forecast': jQuery('#chart').data('forecast'),
            Time: jQuery('#chart').data('time')
        },
      type: 'spline',
      colors: {
            Zero: 'red'
        }
    },
    point: {
      show: false
    },
    axis: {
        x: {
            type: 'timeseries',
            localtime: false,
            tick: {
                format: '%Y-%m-%d'
            }
        },
        y : {
            tick: {
                format: d3.format("$")
            }
        },
    },
    tooltip: {
        format: {
            title: function (d) { return d; },
            value: function (value, ratio, id) {
              if (id != 'Zero'){
                return '$' + value;
              }
            }
        }
    },
    zoom: {
        enabled: true
    },
    subchart: {
        show: true
    }
});

  </script>
</div>
